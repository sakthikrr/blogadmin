
<div class="card p-4 post-edit-card">
  <h2 class="text-center mb-4 font-bold text-2xl text-primary">Edit Post</h2>

  <div *ngIf="isLoading" class="overlay-spinner">
    <p-progressSpinner styleClass="custom-spinner" strokeWidth="4" animationDuration="1s" aria-label="Loading" />
  </div>
  <ng-template [ngIf]="!isLoading">
    <ng-container *ngTemplateOutlet="postEditForm"></ng-container>
  </ng-template>
  <ng-template #postEditForm>
    <form [formGroup]="postForm" (ngSubmit)="onSubmit()" class="p-fluid grid form-section">
      <!-- Post Title -->
      <div class="col-12 md:col-6 mb-3">
        <label for="post_title" class="block font-semibold mb-2">Post Title</label>
        <input id="post_title" formControlName="post_title" type="text" class="p-inputtext w-full" placeholder="Enter post title">
      </div>

      <!-- Post Status -->
      <div class="col-12 md:col-6 mb-3">
        <label for="select_status" class="block font-semibold mb-2">Status</label>
        <p-dropdown 
          formControlName="select_status" 
          [options]="post_status" 
          optionLabel="name" 
          placeholder="Select Status"
          class="w-full">
        </p-dropdown>
      </div>

      <!-- Post Categories -->
      <div class="col-12 md:col-6 mb-3">
        <label for="post_categories" class="block font-semibold mb-2">Categories</label>
        <p-listbox 
          [options]="category_list" 
          formControlName="selectedCategory" 
          optionLabel="name" 
          [multiple]="true" 
          styleClass="w-full">
        </p-listbox>
      </div>
      
      <!-- Post Tags -->
      <div class="col-12 md:col-6 mb-3">
        <label for="post_tags" class="block font-semibold mb-2">Tags</label>
        <app-tags-organizer 
          [selectedTagIds]="selectedTagIds" 
          (tagsChange)="onTagsChange($event)">
        </app-tags-organizer>
      </div>

      <!-- Feature Image -->
      <div class="col-12 md:col-6 mb-3">
        <label class="block font-semibold mb-2">Feature Image</label>
        <div *ngIf="featureImageUrl" class="mb-2 flex flex-column align-items-center">
          <img [src]="featureImageUrl" alt="Feature Image" style="max-width: 180px; max-height: 180px;" class="border-round shadow-2 mb-2"/>
          <p-button icon="pi pi-trash" styleClass="p-button-danger p-button-sm" (onClick)="removeImage()" label="Remove Image"></p-button>
        </div>
        <div *ngIf="!featureImageUrl || !uploadInProgress">
          <p-fileUpload mode="basic" chooseLabel="Browse" 
                      accept="image/*" [auto]="false" 
                      [maxFileSize]="5000000" 
                      (onSelect)="onFileSelect($event)"
                      styleClass="p-button-outlined w-full"></p-fileUpload>
          <small class="block mt-1 text-sm text-600">Max file size: 5MB. Allowed file types: JPEG, PNG, GIF</small>
        </div>
        <div *ngIf="uploadInProgress" class="mt-2">
          <p-progressBar mode="indeterminate" [style]="{'height': '6px'}"></p-progressBar>
          <small class="block mt-1 text-sm text-blue-500">Uploading image...</small>
        </div>
      </div>

      <!-- Post Content -->
      <div class="col-12 mb-3">
        <label for="post_content" class="block font-semibold mb-2">Content</label>
        <p-editor formControlName="post_content" [style]="{ height: '320px', width: '100%' }"></p-editor>
      </div>

      <!-- Hidden Post ID -->
      <input type="hidden" formControlName="post_id">

      <!-- Submit Button -->
      <div class="col-12 flex justify-content-center mt-4">
        <p-button type="submit" label="Update Post" icon="pi pi-check" class="p-button-success px-5 py-2 text-lg" />
      </div>
    </form>
  </ng-template>
</div>

